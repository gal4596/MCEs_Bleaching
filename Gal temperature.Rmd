---
title: "R Notebook"
output: html_notebook
---

```{r}
library(dplyr)
library(tidyr)
library(Rmisc)
library(lubridate)
library(ggplot2)
library(car)
library(MASS)
library(mgcv)
library(MuMIn)
library(emmeans)
```

```{r}
crw<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/NOAA1985-2020_GULF_OF_AQABA.csv", strip.white=T)
crw
crw<- plyr::rename(crw, c("DATE..DDMMYYYY."="Date", "SST.90th_HS"= "Temperature", "DHW_from_90th_HS.1"="DHW"))
crw$Date<-as.Date(crw$Date)
crw$Site<-"NOAA SST"
crw$Site<-as.factor(crw$Site)
crw
```

```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=crw);
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```


```{r}
tempfig<-ggplot(crw, aes(y=Temperature, x=Date))+
geom_vline(xintercept=as.numeric(as.Date("2010-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2015-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2018-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
   geom_vline(xintercept=as.numeric(as.Date("2020-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  geom_point(size=0.5, alpha=0.8)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_smooth(method = "lm", color='black', fill='grey39')+
  geom_point(size=1)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y", expand=c(0.015,0.015))+
  scale_y_continuous(expression(Temperature~(degree~C)), limits=c(19,33), breaks=c(20,22,24,26,28,30,32))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),
        panel.grid.major.x = element_blank() ,
           # explicitly set the horizontal lines (or they will disappear too)
        panel.grid.major.y = element_line( size=.05, color="black" ) ,
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```


```{r}
dhwfig<-ggplot(crw, aes(y=DHW, x=Date))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_vline(xintercept=as.numeric(as.Date("2010-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2015-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2018-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
   geom_vline(xintercept=as.numeric(as.Date("2020-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  geom_line(size=1)+
  geom_area()+
  geom_hline(yintercept = 4, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 8, linetype="longdash", color = 'indianred3', size=0.7, show.legend = TRUE)+
  
  scale_x_date(date_breaks = "1 year", date_labels = "%Y",expand=c(0.015,0.015))+
  scale_y_continuous(expression(Degree~Heating~Weeks), breaks=c(0,4,8,12,16))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12))#making the axis title larger 
dhwfig
```
```{r}
crw$day <- day(as.POSIXlt(crw$Date))
crw$month <- month(as.POSIXlt(crw$Date))
crw$year <- year(as.POSIXlt(crw$Date))

crw<-crw%>%
  mutate(season= ifelse (month %in% c(12, 1, 2), "winter",
                         ifelse(month %in% c(7, 8, 9), "summer", NA)))
crw
```

```{r}
seasonfig<-ggplot(crw, aes(y=Temperature, x=Date, color=season))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_point(size=0.5, alpha=0.8)+
  geom_vline(xintercept=as.numeric(as.Date("2010-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2015-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2018-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
   geom_vline(xintercept=as.numeric(as.Date("2020-09-01")), linetype="solid", color = 'grey', size=4,alpha=0.5, show.legend = TRUE)+
  scale_color_manual("season", values=c("summer"='orange', "winter"= "navyblue","NA"="white"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_smooth(method = "lm")+
  #geom_text(x=as.numeric(as.Date("1992-01-01")), y = 30.5, label = lm_eqn(df), parse = TRUE)+
  #geom_hline(yintercept = 27.27226, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  #geom_hline(yintercept = 28.27226, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_point(size=1)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y", expand=c(0.015,0.015))+
  scale_y_continuous(expression(Temperature~(degree~C)), limits=c(19,33), breaks=c(20,22,24,26,28,30,32))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),
        panel.grid.major.x = element_blank() ,
           # explicitly set the horizontal lines (or they will disappear too)
        panel.grid.major.y = element_line( size=.05, color="black" ) ,#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
seasonfig
```


```{r}
library(cowplot)
noaacompiled<-plot_grid(tempfig,seasonfig,dhwfig, nrow=3, ncol=1,  align="h", axis = "bt")  
noaacompiled
```

#Open ocean
```{r}
o<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/20201211_St_A_Temp_Gal.csv", strip.white=T)
o$Date<-parse_date_time(o$Date,"%d-%m-%y")
o<- plyr::rename(o, c("Temperature_C"= "Temperature", "Depth_m"="Depth"))
o
```
```{r}
o$Date<- as.Date(as.POSIXct(o$Date, origin="1970-01-01"))
tempfig<-ggplot(o, aes(y=Temperature, x=Date, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_point(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=45,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```

#Shallow water temp 2014-2017
```{r}
d<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/Shallow water temp 2014-2017.csv", strip.white=T)
d$Depth..m<-as.factor(d$Depth..m)
d<- plyr::rename(d, c("Date.Time"="Date_Time", "Depth..m"="Depth", "Temp"= "Temperature"))
d<-d %>% 
  mutate(Date_Time = dmy_hm(Date_Time)) %>% 
  separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
d$Date<-as.Date(d$Date)
strftime(d$Date_Time,"%Y-%m-%d %H:%M:%S", tz="GMT+2")
head(d)
```


```{r}
d$Date<- as.Date(as.POSIXct(d$Date, origin="1970-01-01"))
tempfig<-ggplot(d, aes(y=Temperature, x=Date, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_line(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "14 days", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```

#Gal_data_NMP2004-2018-> depth =2m; stationID= diff sites; all 'SST'
```{r}
f<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/Gal_data_NMP2004-2018.csv", strip.white=T)
#f$Depth..m<-as.factor(f$Depth..m)
f<- plyr::rename(f, c("Date_Time.GMT."="Date_Time", "Temp.deg.C."= "Temperature"))
f<-f %>% 
  mutate(Date_Time = dmy_hm(Date_Time)) %>% 
  separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
strftime(f$Date_Time,"%Y-%m-%d %H:%M:%S", tz="GMT+2")
f$Date<-as.Date(f$Date)
f$Station_ID<-as.factor(f$Station_ID)
f$Depth<-"2"
f$Depth<-as.factor(f$Depth)
f
```
#2018_Jul-Sep_temp_60m_SST_10min_interval
```{r}
e<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/2018_Jul-Sep_temp_60m_SST_10min_interval.csv", strip.white=T)
#f$Depth..m<-as.factor(f$Depth..m)
e<- plyr::rename(e, c("Date.Time..GMT.03.00"="Date_Time","Temp...C..60m."="60", "Temp...C..2m.SST."="2"))
e$Date_Time<-parse_date_time(e$Date_Time, order=c('%m-%d-%y %H:%M','%m-%d-%y %I:%M:%S %p'))
e<-e %>% 
  mutate(Date_Time = ymd_hms(Date_Time)) %>% 
  separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
e$Date<-as.Date(e$Date)
e
```

```{r}
library(tidyr)
e.long <- pivot_longer(e, cols=6:7, names_to = "Depth", values_to = "Temperature")
e.long$Depth<-as.factor(e.long$Depth)
#e.long<-filter(e.long, Depth == "60")
e.long
```
```{r}
unique(e.long$Depth)
```


```{r}
e.long$Date<- as.Date(as.POSIXct(e.long$Date, origin="1970-01-01"))
tempfig<-ggplot(e.long, aes(y=Temperature, x=Date_Time, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_point(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  #scale_x_date(date_breaks = "14 days", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```

#2011-2016_in-situ_temp_10
```{r}
g<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/2011-2016_in-situ_temp_10.csv", strip.white=T)
#f$Depth..m<-as.factor(f$Depth..m)
g<- plyr::rename(g, c("Date"="Date_Time","Depth..m"="Depth", "Temp_4"= "Temperature"))
g<-g %>% 
  mutate(Date_Time = dmy_hm(Date_Time)) %>% 
  separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
g$Date<-as.Date(g$Date)
g$Depth<-as.factor(g$Depth)
head(g)
```

```{r}
g$Date<- as.Date(as.POSIXct(g$Date, origin="1970-01-01"))
tempfig<-ggplot(g, aes(y=Temperature, x=Date, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_line(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "6 months", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```

#2011-2016_in-situ_temp_45
```{r}
m<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/2011-2016_in-situ_temp_45.csv", strip.white=T)
#f$Depth..m<-as.factor(f$Depth..m)
m<- plyr::rename(m, c("Date"="Date_Time","Depth..m"="Depth", "Temp_1"= "Temperature"))
m<-m %>% 
  mutate(Date_Time = dmy_hm(Date_Time)) %>% 
  separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
strftime(m$Date_Time,"%Y-%m-%d %H:%M:%S", tz="GMT+2")
m$Date<-as.Date(m$Date)
m$Depth<-as.factor(m$Depth)
head(m)
```
```{r}
m$Date<- as.Date(as.POSIXct(m$Date, origin="1970-01-01"))
tempfig<-ggplot(m, aes(y=Temperature, x=Date, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_line(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "6 months", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```

#2009-2019_Meterological_data_IUI_Eilat - pier
```{r}
k<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/2009-2019_Meterological_data_IUI_Eilat.csv", strip.white=T)
#f$Depth..m<-as.factor(f$Depth..m)
k$Date <- as.Date(k$Date)
k$Date_Time<- as.POSIXct(paste(k$Date, k$Time), "%Y-%m-%d hh:mm:ss")
k<- plyr::rename(k, c("Water.temp...C...2m.depth"= "Temperature"))
k$Depth<-"2"
#k<-k %>% 
  #mutate(Date_Time = dmy_hm(Date_Time)) %>% 
  #separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
k$Depth<-as.factor(k$Depth)
head(k)
```
```{r}
k$Date<- as.Date(as.POSIXct(k$Date, origin="1970-01-01"))
tempfig<-ggplot(k, aes(y=Temperature, x=Date, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_line(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "6 months", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```
###Pier MMM
```{r}
k$hour <- as.POSIXlt(k$Date_Time)$hour
k$day <- day(as.POSIXlt(k$Date_Time))
k$month <- month(as.POSIXlt(k$Date_Time))
k$year <- year(as.POSIXlt(k$Date_Time))
```
```{r}
library(plotrix)
meanminmax<-k%>%
  group_by(year,month, Depth)%>%
  summarize_at(vars(Temperature), funs(mean, std.error,min, max), na.rm=T)
meanminmax
```


```{r}
tempsum_pier<-summarySE(k, measurevar="Temperature", groupvars=c("Date", "year"), na.rm=TRUE)
tempsum_pier
#allflat_2$year<-as.factor(allflat_2$year)
#head(allflat_2)
daysoverMMM1<-tempsum_pier%>%
  dplyr::group_by(year) %>%
  dplyr::summarise(count=sum(Temperature > 28.31, na.rm=T))
daysoverMMM1
```

#Temp_FlouExp_2011-2015_3-36m_36m_2
```{r}
j<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/Temp_FlouExp_2011-2015_3-36m_36m_date.csv", strip.white=T)
j$Date.Time<-parse_date_time(j$Date.Time, order=c('%m/%d/%y %I:%M:%S %p','%d/%m/%y %H:%M:%S'))
#f$Depth..m<-as.factor(f$Depth..m)
#j$Date <- as.Date(j$Date)
#j$Date_Time<- as.POSIXct(paste(j$Date, j$Time), "%Y-%m-%d hh:mm:ss")
j<- plyr::rename(j, c("Date.Time"="Date_Time","Depth..m"="Depth", "Temp...C"= "Temperature"))
j<-j %>% 
  mutate(Date_Time = ymd_hms(Date_Time)) %>% 
  separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
j$Date<-as.Date(j$Date)
j$Depth<-as.factor(j$Depth)
j
```

```{r}
k$Date<- as.Date(as.POSIXct(k$Date, origin="1970-01-01"))
tempfig<-ggplot(j, aes(y=Temperature, x=Date_Time, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_point(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  #scale_x_date(date_breaks = "6 months", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```

```{r}
z<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/Temp_FlouExp_2011-2015_3-36m_3m_date.csv", strip.white=T)
z$Date.Time..GMT.03.00<-parse_date_time(z$Date.Time..GMT.03.00, order=c('%m/%d/%y %I:%M:%S %p','%d/%m/%y %H:%M:%S'))
#f$Depth..m<-as.factor(f$Depth..m)
#j$Date <- as.Date(j$Date)
#j$Date_Time<- as.POSIXct(paste(j$Date, j$Time), "%Y-%m-%d hh:mm:ss")
z<- plyr::rename(z, c("Date.Time..GMT.03.00"="Date_Time","Depth..m"="Depth", "Temp...C"= "Temperature"))
z<-z %>% 
  mutate(Date_Time = ymd_hms(Date_Time)) %>% 
  separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
z$Date<-as.Date(z$Date)
z$Depth<-as.factor(z$Depth)
z
```
```{r}
tempfig<-ggplot(z, aes(y=Temperature, x=Date_Time, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_point(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  #scale_x_date(date_breaks = "6 months", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```
#2016-2017_Ronen_temp_in_situ_data_5m, '%d/%m/%Y','%d-%m-%y','%d-%m-%y'
```{r}
x5<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/2016-2017_Ronen_5m_new.csv", strip.white=T)
x5<- plyr::rename(x5, c("date"="Date","time"="Time","depth"="Depth", "temp"= "Temperature"))
x5$Date<-parse_date_time(x5$Date,order = c('m-d-y','%d/%m/%Y'))
#x5$Date<-parse_date_time(x5$Date, order=c('%m-%d-%y','%d-%m-%y'))
#x5$Date<-parse_date_time(x5$Date, order=c('%d/%m/%Y'))
x5$Date<-as.Date(x5$Date)
x5<-x5[complete.cases(x5), ]
x5$Date_Time<- as.POSIXct(paste(x5$Date, x5$Time), "%Y-%m-%d hh:mm:ss")


x5$Date<-as.Date(x5$Date)
x5$Depth<-"10"
x5$Depth<-as.factor(x5$Depth)
x5
```

```{r}
unique(x5$Date)
```

```{r}
x5$Date<- as.Date(as.POSIXct(x5$Date, origin="1970-01-01"))
tempfig<-ggplot(x5, aes(y=Temperature, x=Date_Time, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_point(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  #geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  #scale_x_date(date_breaks = "6 months", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```



#2016-2017_Ronen_temp_in_situ_data_45m
```{r}
x45<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/2016-2017_Ronen_temp_in_situ_data_45m.csv", strip.white=T)
x45<- plyr::rename(x45, c("date"="Date","time"="Time","depth"="Depth", "temp"= "Temperature"))
x45$Date<-parse_date_time(x45$Date, order=c('%m-%d-%y', '%d/%m/%Y','%d-%m-%y'))
x45$Date_Time<- as.POSIXct(paste(x45$Date, x45$Time), "%Y-%m-%d hh:mm:ss")

x45<-x45 %>% 
  mutate(Date_Time = ymd_hms(Date_Time)) %>% 
  separate(Date_Time, into = c('Date', 'Time'), sep=' ', remove = FALSE)
x45$Date<-as.Date(x45$Date)
x45$Depth<-as.factor(x45$Depth)
x45
```
```{r}
unique(x5$Date)
```

#2015-2016_Bar_temp_in_situ_data.csv
```{r}
n<-read.csv("/Users/imkri/Desktop/Penn Postdoc/Gal temperature/2015-2016_Bar_temp_in_situ_data.csv", strip.white=T)
#f$Depth..m<-as.factor(f$Depth..m)
n<- plyr::rename(n, c("Temp_5m"="10", "Temp_45m"="45"))
n$Date<-as.Date(n$Date)
n
```

```{r}
library(tidyr)
n.long <- pivot_longer(n, cols=2:3, names_to = "Depth", values_to = "Temperature")
n.long$Depth<-as.factor(n.long$Depth)
#e.long<-filter(e.long, Depth == "60")
n.long
```


#Combine
```{r}
alltemp<- merge(d,e.long, by=c("Date_Time","Temperature", "Date", "Time","Depth"), all=T)
alltemp<- merge(alltemp, g, by=c("Date_Time","Temperature","Date","Time","Depth"), all=T)
alltemp<- merge(alltemp, m, by=c("Date_Time","Temperature","Date","Time","Depth"), all=T)
alltemp<- merge(alltemp, j, by=c("Date_Time","Temperature","Date","Time","Depth"), all=T)
alltemp<- merge(alltemp, z, by=c("Date_Time","Temperature","Date","Time","Depth"), all=T)
alltemp<- merge(alltemp, n.long, by=c("Temperature","Date","Depth"), all=T)
alltemp
```
```{r}
unique(alltemp$Depth)
```

```{r}
tempfig<-ggplot(alltemp, aes(y=Temperature, x=Date_Time, color=Depth))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_point(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  facet_grid(Depth~.)+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  #scale_x_date(date_breaks = "6 months", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```

```{r}
alltemp$Depth<-as.character(alltemp$Depth)
alltemp$hour <- as.POSIXlt(alltemp$Date_Time)$hour
alltemp$day <- day(as.POSIXlt(alltemp$Date_Time))
alltemp$month <- month(as.POSIXlt(alltemp$Date_Time))
alltemp$year <- year(as.POSIXlt(alltemp$Date_Time))

alltemp<-alltemp%>%
  mutate(Depth_sum= ifelse (Depth  %in% c("0","0.5","1","1.5","2","3"), "<3m",
                         ifelse(Depth %in% c("4","5","6","7","8","9","10"), "4-10m",
                                ifelse(Depth %in% c("11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"), "11-30m", 
                                       ifelse(Depth %in% c("31","32","33","34","35","36","37","38","39","40","41","42","43","44","45"),  "31-45m",
                                              ifelse(Depth %in% c("46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"), "46-60m",
                                                     ifelse(Depth %in% c("100", "150", "200", "250" ,"290", "330", "400", "470", "570","275" ,"299", "350","450", "498", "549" ,"601", "678","80",  "101" ,"153" ,"298", "393", "416", "433" ,"600","640" ,"661", "680", "681","99",  "140", "201", "360", "300" ,"358", "420","500", "650","700" ,"723", "347","370", "550", "706","174", "120", "160", "180", "220",
"251","747","675", "720","390","395","125","176","249", "357" ,"625", "666","85","106","175", "225", "750", "800", "830", "860","70",  "119", "551" ,"690" ,"128" ,"363", "170", "441","695", "130", "349" ,"599", "724","81",  "354" ,"721", "213" ,"375", "320", "353", "670", "712", "857", "327", "711" ,"651","399" ,"742", "402", "161", "131", "428", "109", "89",  "710","385", "124", "199","696", "855" ,"727", "121", "244", "293", "341", "439", "488", "537", "585", "634", "683", "732", "649","494", "707" ,"448","411" ,"737" ,"149", "401", "735", "449", "302", "725", "602","699", "729", "79", "82" , "442", "501", "202", "159", "451", "348", "719", "148", "425","139", "701", "248", "351", "71",  "398", "722", "499", "198", "181", "151", "548", "301", "297","730", "850", "826", "702", "598", "713",   "708", "78", "98",  "736" ,"178", "141","179", "698", "158", "440", "757", "252", "716", "352", "242", "749", "687", "525", "575", "751","861", "624", "524", "574", "851", "526", "648", "573", "626", "728", "674", "447", "676", "801", "122","859", "403", "685",  "862", "714", "62",  "576", "717", "715", "83",  "755" ,"718", "705", "853", "42",  "44",  "856", "743","703", "748"),">61m",
                                                             NA))))))) %>%
  mutate(daynight= ifelse (hour %in% c(8,9,10,11,12,13,14), "day",
         ifelse (hour %in% c(22,23,0,1,2,3), "night", NA))) 

alltemp$Depth_sum<-as.factor(alltemp$Depth_sum)
alltemp
```



```{r}
#unique(alltemp$Depth)
unique(alltemp$Depth_sum)
```

```{r}
#alltemp$Depth_sum<- factor(alltemp$Depth_sum, levels =c("<3m"," 4-10m","11-30m ","31-45m ", "46-60m",">61m"))
tempfig<-ggplot(alltemp, aes(y=Temperature, x=Date_Time, color=Depth_sum))+
  #geom_jitter(data=alltempgrace, aes(y=Temperature, x=Date, color="black"), alpha=0.2, size=1, position=position_jitterdodge(0.4))+
  geom_point(size=1)+
  #geom_ribbon(aes(ymin=Tempcorrected-se, ymax=Tempcorrected+se), alpha=0.4)+
  #facet_grid(Parameter~., scales = "free")+
  #scale_fill_manual("Temperature", values=c("black"))+
  #scale_color_manual("Temperature", values=c("black"))+
  #scale_colour_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  #scale_fill_grey("Site", start = 0.0, end = 1.0,na.value = "red", aesthetics = "colour")+
  geom_hline(yintercept = 27.5569, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.5569, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  #scale_x_date(date_breaks = "6 months", date_labels = "%d %b %Y")+
  scale_y_continuous(expression(Temperature~(degree~C)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
tempfig
```

#Comparison 2, 5-10, 45 only

```{r}
comparison<-merge(m,g, by=c("Temperature", "Date", "Depth"), all=T)
comparison<- merge(comparison, k, by=c("Temperature","Date","Depth"), all=T)
comparison<- merge(comparison, x5, by=c("Temperature","Date","Depth"), all=T)
comparison<- merge(comparison, x45, by=c("Temperature","Date","Depth"), all=T)
comparison<- merge(comparison, n.long, by=c("Temperature","Date","Depth"), all=T)
comparison <- comparison[ -c(4:34) ]
comparison
```

```{r}
comparison$day <- day(as.POSIXlt(comparison$Date))
comparison$month <- month(as.POSIXlt(comparison$Date))
comparison$year <- year(as.POSIXlt(comparison$Date))

comparison_sub<-comparison%>%
  dplyr::filter(Date > "2011-07-20" & Date <"2017-09-02")
comparison_sub
```
```{r}
comparison_sub$Date<-as.Date(comparison_sub$Date)
comparison_sub
```

```{r}
write.csv(comparison_sub, "2011-2017 data revised Jan 2021.csv")
```

```{r}
library(plotrix)
meanminmax<-comparison_sub%>%
  group_by(year,month, Depth)%>%
  summarize_at(vars(Temperature), funs(mean, std.error,min, max), na.rm=T)
meanminmax
```

###Degree heating days between 2011-07-20 & 2017-09-02 for 2, 5-10 ("10"), and 45m 
```{r}
tempsum_compare<-summarySE(comparison_sub, measurevar="Temperature", groupvars=c("Date", "Depth", "year"), na.rm=TRUE)
tempsum_compare
#allflat_2$year<-as.factor(allflat_2$year)
#head(allflat_2)
daysoverMMM2<-tempsum_compare%>%
  dplyr::filter(Depth=="2")%>%
  dplyr::filter(Date > "2011-07-20" & Date <"2017-09-02") %>%
  dplyr::group_by(year, Depth) %>%
  dplyr::summarise(count=sum(Temperature > 28.272, na.rm=T))
daysoverMMM2
daysoverMMM10<-tempsum_compare%>%
  dplyr::filter(Depth=="10")%>%
  dplyr::filter(Date > "2011-07-20" & Date <"2017-09-02") %>%
  dplyr::group_by(year, Depth) %>%
  dplyr::summarise(count=sum(Temperature > 27.739, na.rm=T))
daysoverMMM10
daysoverMMM45<-tempsum_compare%>%
  dplyr::filter(Depth=="45")%>%
  dplyr::filter(Date > "2011-07-20" & Date <"2017-09-02") %>%
  dplyr::group_by(year, Depth) %>%
  dplyr::summarise(count=sum(Temperature > 26.369, na.rm=T))
daysoverMMM45
```
```{r}
comparison_DHW2<-comparison_sub%>%
  dplyr::filter(Depth=="2")%>%
  group_by(Date, Depth)%>%
  mutate(Hotspot= ifelse(Temperature >=28.272, Temperature-27.272, 0))
comparison_DHW2
```
```{r}
#write.csv(comparison_DHW2, "Hotspot 2m.csv")
```

```{r}
comparison_DHW10<-comparison_sub%>%
  dplyr::filter(Depth=="10")%>%
  group_by(Date)%>%
  mutate(Hotspot= ifelse(Temperature >=27.739, Temperature-26.739, 0))
comparison_DHW10
```
```{r}
#write.csv(comparison_DHW10, "Hotspot 10m.csv")
```

```{r}
#comparison_sub$Date<-as.character(comparison_sub$Date)
comparison_DHW45<-tempsum_compare%>%
  dplyr::filter(Depth=="45")%>%
  dplyr::group_by(Date)%>%
  mutate(Hotspot= ifelse(Temperature >=26.369, Temperature-25.369, 0))
comparison_DHW45
```
```{r}
write.csv(comparison_DHW45, "Hotspot 45m.csv")
```

###Mean, Max, Min
```{r}
tempsum_compare$Depth<-factor(tempsum_compare$Depth, levels=c("2","10","45"))
meanminmax_2<-tempsum_compare%>%
  group_by(year, Depth)%>%
  summarize_at(vars(Temperature), funs(mean, std.error,min, max), na.rm=T)
meanminmax_2
```
```{r}
#tempsum_compare_minmax$Depth<-factor(tempsum_compare_minmax$Depth, levels=c("2","10","45"))
tempsum_compare_minmax<-comparison_sub%>%
  group_by(Date,Depth)%>%
  summarize_at(vars(Temperature), funs(mean, std.error,min, max), na.rm=T)
tempsum_compare_minmax
```

```{r}
tempsum_compare_minmax$Temp_amp <- (tempsum_compare_minmax$max - tempsum_compare_minmax$min)
tempsum_compare_minmax
```

```{r}
tempsum_compare_minmax<-do.call(data.frame,lapply(tempsum_compare_minmax, function(x) replace(x, is.infinite(x),NA)))
tempsum_compare_minmax$day <- day(as.POSIXlt(tempsum_compare_minmax$Date))
tempsum_compare_minmax$month <- month(as.POSIXlt(tempsum_compare_minmax$Date))
tempsum_compare_minmax$year <- year(as.POSIXlt(tempsum_compare_minmax$Date))
tempsum_compare_minmax
```
```{r}
library(plotrix)
amp<-tempsum_compare_minmax%>%
  group_by(year,Depth)%>%
  summarize_at(vars(Temp_amp), funs(mean,std.error,sd), na.rm=T)
amp
```
###Figure
```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=subset(tempsum_compare, Depth==c("2")));
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```

```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
comparison_sub$Depth <- factor(comparison_sub$Depth, levels=c("2","10", "45"))
compare2fig<-ggplot(data=subset(tempsum_compare, Depth==c("2")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 27.27226, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.27226, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
  scale_y_continuous(expression(Temperature~(degree~C)), limits=c(20,30), breaks=c(20,22,24,26,28,30))+
  #geom_smooth(method = "lm", color='black', fill='grey39')+
  geom_vline(xintercept=as.numeric(as.Date("2015-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  geom_point(size=1, color="paleturquoise3")+
  #geom_ribbon(aes(ymin=Temperature-se, ymax=Temperature+se), alpha=0.4, color="paleturquoise3")+
  #geom_text(x=as.numeric(as.Date("2013-01-01")), y = 28.5, label = lm_eqn(df), parse = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2010-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2018-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
compare2fig
```
```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=subset(tempsum_compare, Depth==c("10")));
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```

```{r}
comparisum<-summarySE(comparison_sub, measurevar="Temperature", groupvars=c("Date", "Depth"), na.rm=TRUE)
comparisum
```

```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
comparison_sub$Date<- as.Date(as.POSIXct(comparison_sub$Date, origin="1970-01-01"))
#comparison_sub$Date <- factor(comparison_sub$Date, ordered = T)
comparison_sub$Depth <- factor(comparison_sub$Depth, levels=c("2","10", "45"))
compare10fig<-ggplot(data=subset(tempsum_compare, Depth==c("10")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 26.73898, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 27.73898, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
  scale_y_continuous(expression(Temperature~(degree~C)), limits=c(20,30), breaks=c(20,22,24,26,28,30))+
  #geom_smooth(method = "lm", color='black', fill='grey39')+
  geom_vline(xintercept=as.numeric(as.Date("2015-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  #geom_smooth(method = "lm", color='black', fill='grey39')+
  #geom_text(x=as.numeric(as.Date("2013-01-01")), y = 28.5, label = lm_eqn(df), parse = TRUE)+
  geom_point(size=1, color="darkslategray3")+
  #geom_vline(xintercept=as.numeric(as.Date("2010-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2018-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
compare10fig
```

```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=subset(tempsum_compare, Depth==c("45")));
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```

```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
comparison_sub$Depth <- factor(comparison_sub$Depth, levels=c("2","10", "45"))
compare45fig<-ggplot(data=subset(tempsum_compare, Depth==c("45")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 25.36923, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 26.36923, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
  scale_y_continuous(expression(Temperature~(degree~C)), limits=c(20,30), breaks=c(20,22,24,26,28,30))+
  #geom_smooth(method = "lm", color='black', fill='grey39')+
  geom_vline(xintercept=as.numeric(as.Date("2015-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  #geom_smooth(method = "lm", color='black', fill='grey39')+
  #geom_text(x=as.numeric(as.Date("2013-01-01")), y = 28.5, label = lm_eqn(df), parse = TRUE)+
  geom_point(size=1, color="steelblue4")+
  #geom_vline(xintercept=as.numeric(as.Date("2010-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2018-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
compare45fig
```

###Compare compiled figure
```{r}
library(cowplot)
comparecompiled<-plot_grid(compare2fig,compare10fig, compare45fig, nrow=3, ncol=1,  align="h", axis = "bt")  
comparecompiled
```


```{r}
o
```

```{r}
#using the open ocean long-term temperature record, we determine the MMM for specific depth ranges
o$day <- day(as.POSIXlt(o$Date))
o$month <- month(as.POSIXlt(o$Date))
o$year <- year(as.POSIXlt(o$Date))

o<-o%>%
  mutate(season= ifelse (month %in% c(12,1,2), "winter",
                         ifelse(month %in% c(3,4,5), "spring",
                                ifelse(month %in% c(6,7,8), "summer", 
                                       ifelse(month %in% c(9,10,11), "autumn", NA))))) %>%
  mutate(Depth_sum= ifelse(Depth >=0 & Depth <=3, "<3m",
                         ifelse(Depth >=7 & Depth <=21, "7-21m",
                                ifelse(Depth >=38 & Depth <=41, "38-41m",
                                              ifelse(Depth >=49.9 & Depth <=62, "49.9-62m",
                                                      ifelse(Depth >=70 & Depth <=90, "70-90m",
                                                             ifelse(Depth >=99 & Depth <=161, "99-161m",
                                                                    ifelse(Depth >=175 & Depth <=760, "175-760m",NA))))))))
```

```{r}
o
```
```{r}
write.csv(o,"open ocean with depth bin.csv")
```

```{r}
unique(o$Depth_sum)
```

```{r}
#mean, SE, min and max for month, year and the depth bins
library(plotrix)
meanminmax<-o%>%
  group_by(month, year, Depth_sum)%>%
  summarize_at(vars(Temperature), funs(mean, std.error,min, max), na.rm=T)
meanminmax
```

```{r}
#to determine the long-term MMM, we took the hottest temperature in August (as NOAA does), and averaged those temperatures by depth bin to get the MMM per depth bin
mmm<-o%>%
  filter(month == "8")%>%
  group_by(year, Depth_sum)%>%
  summarize_at(vars(Temperature), funs(max), na.rm=T)
mmm<-do.call(data.frame,lapply(mmm, function(x) replace(x, is.infinite(x),NA)))
mmm
```
###MMM by depth bin from open ocean data

```{r}
mmm2<-mmm%>%
  group_by(Depth_sum)%>%
  summarize_at(vars(Temperature), funs(mean, std.error), na.rm=T)
mmm2
```

###GAMs

```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=subset(o, Depth_sum==c("<3m")));
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```

```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
o$Depth_sum <- factor(o$Depth_sum, levels=c("<3m","7-21m", "38-41m", "49.9-62m","70-90m","99-161m", "175-760m"))
smooth3m<-ggplot(data=subset(o, Depth_sum==c("<3m")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 27.27226, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 28.27226, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
 scale_y_continuous(expression(Temperature~(degree~C)), limits=c(20,30), breaks=c(20,22,24,26,28,30))+
  #geom_smooth(method = "lm", color='black', fill='grey39')+
  geom_smooth(method = "lm", color='paleturquoise3', fill='grey39')+
  geom_point(size=2, color="paleturquoise3")+
  geom_line(size=1,color="paleturquoise3")+
  #geom_text(x=as.numeric(as.Date("2007-01-01")), y = 28.5, label = lm_eqn(df), parse = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2010-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2015-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2018-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
smooth3m
```


```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=subset(o, Depth_sum==c("7-21m")));
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```

```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
o$Depth_sum <- factor(o$Depth_sum, levels=c("<3m","7-21m", "38-41m", "49.9-62m","70-90m","99-161m", "175-760m"))
smooth620m<-ggplot(data=subset(o, Depth_sum==c("7-21m")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 26.73898, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 27.73898, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
  scale_y_continuous(expression(Temperature~(degree~C)), limits=c(20,30), breaks=c(20,22,24,26,28,30))+
  geom_smooth(method = "lm", color='darkslategray3', fill='grey39')+
  geom_point(size=2, color="darkslategray3")+
  geom_line(size=1,color="darkslategray3")+
  #geom_text(x=as.numeric(as.Date("2007-01-01")), y = 28.5, label = lm_eqn(df), parse = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2010-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2015-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2018-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
smooth620m
```
```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=subset(o, Depth_sum==c("38-41m")));
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```


```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
o$Depth_sum <- factor(o$Depth_sum, levels=c("<3m","7-21m", "38-41m", "49.9-62m","70-90m","99-161m", "175-760m"))
smooth2140m<-ggplot(data=subset(o, Depth_sum==c("38-41m")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 25.90045, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 26.90045, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
 scale_y_continuous(expression(Temperature~(degree~C)), limits=c(20,30), breaks=c(20,22,24,26,28,30))+
  geom_smooth(method = "lm", color='cyan4', fill='grey39')+
  geom_point(size=2, color="cyan4")+
  geom_line(size=1,color="cyan4")+
  #geom_text(x=as.numeric(as.Date("2007-01-01")), y = 28.5, label = lm_eqn(df), parse = TRUE)+
  #ggtitle("<3m - SST")+
  #geom_vline(xintercept=as.numeric(as.Date("2010-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2015-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2018-08-01")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
smooth2140m
```

```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=subset(o, Depth_sum==c("49.9-62m")));
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```

```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
o$Depth_sum <- factor(o$Depth_sum, levels=c("<3m","7-21m", "38-41m", "49.9-62m","70-90m","99-161m", "175-760m"))
smooth5070m<-ggplot(data=subset(o, Depth_sum==c("49.9-62m")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 25.36923, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 26.36923, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
scale_y_continuous(expression(Temperature~(degree~C)), limits=c(20,30), breaks=c(20,22,24,26,28,30))+
  geom_vline(xintercept=as.numeric(as.Date("2010-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2015-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2018-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  geom_smooth(method = "lm", color='steelblue4', fill='grey39')+
  geom_point(size=2, color="steelblue4")+
  geom_line(size=1,color="steelblue4")+
  #geom_text(x=as.numeric(as.Date("2007-01-01")), y = 28.5, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        #legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
smooth5070m
```
```{r}
lm_eqn <- function(df){
    m <- lm(Temperature ~ Date, data=subset(o, Depth_sum==c("70-90m")));
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(unname(coef(m)[1]), digits = 2),
              b = format(unname(coef(m)[2]), digits = 2),
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));
}
```


```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
o$Depth_sum <- factor(o$Depth_sum, levels=c("<3m","7-21m", "38-41m", "49.9-62m","70-90m","99-161m", "175-760m"))
smooth71m<-ggplot(data=subset(o, Depth_sum==c("70-90m")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 24.73014, linetype="dashed", color = 'indianred3', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 25.73014, linetype="solid", color = 'indianred3', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
scale_y_continuous(expression(Temperature~(degree~C)), limits=c(20,30), breaks=c(20,22,24,26,28,30))+
  geom_vline(xintercept=as.numeric(as.Date("2010-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2015-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2018-09-01")), linetype="solid", color = 'grey', size=10,alpha=0.5, show.legend = TRUE)+
  geom_smooth(method = "lm", color='navyblue', fill='grey39')+
  geom_point(size=2, color="navyblue")+
  geom_line(size=1,color="navyblue")+
  #geom_text(x=as.numeric(as.Date("2007-01-01")), y = 28.5, label = lm_eqn(df), parse = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
smooth71m
```
```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
o$Depth_sum <- factor(o$Depth_sum, levels=c("<3m","7-21m", "38-41m", "49.9-62m","70-90m","99-161m", "175-760m"))
smooth99m<-ggplot(data=subset(o, Depth_sum==c("99-161m")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 23.99292, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 24.99292, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
  scale_y_continuous(expression(Temperature~(degree~C)),limits=c(20.5,29))+
  geom_point(size=1)+
  geom_line()+
  #geom_smooth(method="gam",
              #formula= y ~ s(x, k=50),
              #method.args=list(family="gaussian"), color='black', fill='grey39')+
  ggtitle("99-161m - lower MCE")+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
smooth99m
```
```{r}
#use data o; depth_sum = <5m, 6-20m, 21-40m, 41-49m, 50-70m,>71m
o$Depth_sum <- factor(o$Depth_sum, levels=c("<3m","7-21m", "38-41m", "49.9-62m","70-90m","99-161m", "175-760m"))
smooth175m<-ggplot(data=subset(o, Depth_sum==c("175-760m")), aes(y=Temperature, x=Date))+
  geom_hline(yintercept = 21.92485, linetype="solid", color = 'black', size=0.7, show.legend = TRUE)+
  geom_hline(yintercept = 22.92485, linetype="dashed", color = 'black', size=0.7, show.legend = TRUE)+
  scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
  scale_y_continuous(expression(Temperature~(degree~C)),limits=c(20.5,29))+
  geom_point(size=1)+
  geom_line()+
  #geom_smooth(method="gam",
              #formula= y ~ s(x, k=50),
              #method.args=list(family="gaussian"), color='black', fill='grey39')+
  ggtitle("175-760m - deep water")+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5,size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = -20), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        legend.position="none",
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(size=12))#making the axis title larger 
smooth175m
```


##Compiled figure
```{r}
library(cowplot)
templine<-plot_grid(smooth3m,smooth620m, 
                    smooth2140m,smooth5070m,
                    smooth71m,nrow=5, ncol=1,  align="h", axis = "bt")  
templine
```

###Stats
```{r}
temp.lm <- lm(Temperature~Depth_sum, data=o,na.action=na.exclude)
Anova(temp.lm, type=3)
tukey3<- emmeans(temp.lm, list(pairwise ~ Depth_sum), adjust = "tukey")
tukey3
```


